
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>materialender</title>
  
  <style>
  /* =========================================
   AuraDate V2.0 - Compact & Animated CSS
   ========================================= */

:root {
  /* Animation Speeds */
  --anim-speed: 0.3s;
  
  /* Light Mode (Light Blue -> Pink) */
  --bg-gradient: linear-gradient(125deg, #a1c4fd 0%, #c2e9fb 50%, #fbc2eb 100%);
  --glass-bg: rgba(255, 255, 255, 0.35);
  --glass-border: rgba(255, 255, 255, 0.6);
  --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
  --text-main: #2d3436;
  --text-muted: #636e72;
  --accent: #6c5ce7;
  --neumorph-shadow: 
    4px 4px 8px rgba(163, 177, 198, 0.4), 
    -4px -4px 8px rgba(255, 255, 255, 0.8);
  --neumorph-inset: 
    inset 4px 4px 8px rgba(163, 177, 198, 0.4), 
    inset -4px -4px 8px rgba(255, 255, 255, 0.8);
}

@media (prefers-color-scheme: dark) {
  :root {
    /* Dark Mode (Dark Blue -> Electric Cyan) */
    --bg-gradient: linear-gradient(125deg, #0f2027 0%, #203a43 40%, #2c5364 70%, #00f260 100%);
    --glass-bg: rgba(16, 20, 30, 0.7);
    --glass-border: rgba(255, 255, 255, 0.1);
    --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
    --text-main: #dfe6e9;
    --text-muted: #b2bec3;
    --accent: #00d2d3;
    --neumorph-shadow: 
      4px 4px 10px rgba(0, 0, 0, 0.5), 
      -2px -2px 5px rgba(255, 255, 255, 0.05);
    --neumorph-inset: 
      inset 4px 4px 10px rgba(0, 0, 0, 0.5), 
      inset -2px -2px 5px rgba(255, 255, 255, 0.05);
  }
}

body {
  margin: 0;
  font-family: 'Roboto', sans-serif;
  background: var(--bg-gradient);
  background-size: 200% 200%;
  animation: auraFlow 10s ease infinite;
  color: var(--text-main);
  height: 100vh;
  overflow: hidden; /* Prevent body scroll */
  display: flex;
  flex-direction: column;
}

@keyframes auraFlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* =========================================
   Layout & Containers
   ========================================= */

#app-container {
  padding: 10px 15px;
  height: 100vh;
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-width: 1400px;
  margin: 0 auto;
  width: 100%;
  box-sizing: border-box;
}

#search-container {
  flex-shrink: 0;
}

#calendar {
  flex-grow: 1;
  background: var(--glass-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  box-shadow: var(--glass-shadow);
  padding: 10px;
  overflow: hidden;
  position: relative;
}

/* Light Physics: Specular Highlight on top edge */
#calendar::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
  opacity: 0.6;
}

/* =========================================
   Input Styles (Search & Modal)
   ========================================= */

input[type=text], input[type=datetime-local], input[type=number], select {
  width: 100%;
  padding: 8px 12px;
  margin: 5px 0;
  border: none;
  border-radius: 8px;
  background: transparent;
  color: var(--text-main);
  box-shadow: var(--neumorph-inset);
  font-size: 0.9rem;
  transition: all var(--anim-speed);
  box-sizing: border-box;
}

input:focus, select:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--accent);
}

#eventSearch {
  border-radius: 20px;
  padding: 8px 16px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  box-shadow: var(--neumorph-shadow);
}

/* =========================================
   FullCalendar Compact Overrides
   ========================================= */

.fc {
  font-size: 0.85rem; /* Smaller global font */
  height: 100%;
}

.fc-header-toolbar {
  margin-bottom: 8px !important;
  padding: 0 4px;
}

.fc-toolbar-title {
  font-size: 1.1rem !important;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Neumorphic Buttons */
.fc-button {
  background: var(--glass-bg) !important;
  border: none !important;
  color: var(--text-main) !important;
  box-shadow: var(--neumorph-shadow) !important;
  border-radius: 6px !important;
  padding: 4px 10px !important;
  font-size: 0.8rem !important;
  text-transform: capitalize;
  font-weight: 600;
  transition: transform 0.1s;
}

.fc-button:hover {
  transform: translateY(-1px);
  filter: brightness(1.1);
}

.fc-button:active, .fc-button-active {
  box-shadow: var(--neumorph-inset) !important;
  transform: translateY(1px);
  color: var(--accent) !important;
}

/* Grid Compactness */
.fc-view-harness {
  background: rgba(0,0,0,0.02);
  border-radius: 8px;
}

.fc-col-header-cell-cushion {
  padding: 4px;
  font-weight: 600;
  color: var(--text-muted);
}

.fc-daygrid-day-number {
  padding: 2px 6px;
  font-size: 0.8rem;
  margin: 2px;
  border-radius: 50%;
  transition: 0.2s;
}

.fc-day-today {
  background: transparent !important;
}

.fc-day-today .fc-daygrid-day-number {
  background: var(--accent);
  color: #fff;
  box-shadow: 0 0 8px var(--accent);
}

.fc-daygrid-day-frame {
  min-height: 100% !important; /* Force fit */
}

/* Events */
.fc-event {
  border: none !important;
  border-radius: 4px;
  padding: 1px 4px;
  margin-bottom: 1px;
  font-size: 0.75rem;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  backdrop-filter: blur(4px);
  transition: transform 0.2s;
}

.fc-event:hover {
  transform: scale(1.02);
  z-index: 5;
}

/* =========================================
   Modal (Compact Glass)
   ========================================= */

.modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.4);
  backdrop-filter: blur(3px);
  animation: fadeIn 0.2s;
}

.modal-content {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  margin: 5vh auto; /* Higher up */
  padding: 20px;
  border: 1px solid var(--glass-border);
  width: 90%;
  max-width: 380px; /* Small width */
  border-radius: 16px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.2);
  position: relative;
  max-height: 90vh;
  overflow-y: auto;
}

@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

.close-button {
  color: var(--text-muted);
  float: right;
  font-size: 24px;
  font-weight: bold;
  line-height: 20px;
  cursor: pointer;
}

.close-button:hover { color: var(--accent); }

h2 {
  font-size: 1.2rem;
  margin: 0 0 15px 0;
  color: var(--text-main);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding-bottom: 5px;
}

label {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-top: 8px;
  display: block;
}

input[type=checkbox] {
  margin-right: 8px;
  vertical-align: middle;
}

/* Modal Buttons */
button {
  width: 100%;
  padding: 10px;
  margin: 10px 0 0 0;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.9rem;
  background: var(--glass-bg);
  box-shadow: var(--neumorph-shadow);
  color: var(--text-main);
  transition: all 0.2s;
}

button:hover {
  transform: translateY(-2px);
  filter: brightness(1.1);
}

button:active {
  box-shadow: var(--neumorph-inset);
  transform: translateY(0);
}

#saveEvent {
  background: var(--accent);
  color: white;
  box-shadow: 0 4px 10px rgba(108, 92, 231, 0.4);
}

#deleteEvent {
  color: #ff7675;
  background: transparent;
  box-shadow: none;
  border: 1px solid #ff7675;
  padding: 8px;
  margin-top: 5px;
}

#deleteEvent:hover {
  background: #ff7675;
  color: white;
}

/* Mobile Tweak */
@media (max-width: 600px) {
  .fc-toolbar-title { font-size: 1rem !important; }
  .fc-button { padding: 4px 8px !important; font-size: 0.75rem !important; }
  #app-container { padding: 5px; }
}
  </style>
  
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
</head>
<body>

  <div id="app-container">
    <div id="search-container">
      <input type="text" id="eventSearch" placeholder="Search for events...">
    </div>
    <div id="calendar"></div>
  </div>

  <!-- Event Modal -->
  <div id="eventModal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2 id="modalTitle">Add Event</h2>
      <input type="hidden" id="eventId">
      <label for="eventTitle">Event Title</label>
      <input type="text" id="eventTitle" placeholder="Event Title">
      <label for="eventStart">Start Time</label>
      <input type="datetime-local" id="eventStart">
      <label for="eventEnd">End Time</label>
      <input type="datetime-local" id="eventEnd">
      <label>
        <input type="checkbox" id="allDay"> All-day event
      </label>
      <br><br>
      <label for="eventCategory">Category</label>
      <select id="eventCategory">
        <option value="#03a9f4">Default</option>
        <option value="#f44336">Work</option>
        <option value="#4caf50">Personal</option>
        <option value="#ff9800">Urgent</option>
      </select>
      <label for="eventReminder">Reminder (minutes before)</label>
      <input type="number" id="eventReminder" placeholder="e.g., 15">
      <button id="saveEvent">Save</button>
      <button id="deleteEvent" style="display:none;">Delete</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // IndexedDB Setup
      let db;
      const dbRequest = indexedDB.open('materialenderDB', 1);

      dbRequest.onupgradeneeded = function(event) {
        db = event.target.result;
        if (!db.objectStoreNames.contains('events')) {
          db.createObjectStore('events', { keyPath: 'id', autoIncrement: true });
        }
      };

      dbRequest.onsuccess = function(event) {
        db = event.target.result;
        loadEventsFromDB();
      };

      dbRequest.onerror = function(event) {
        console.error('Database error:', event.target.errorCode);
      };

      // Calendar and Modal Elements
      var calendarEl = document.getElementById('calendar');
      var modal = document.getElementById('eventModal');
      var closeButton = document.getElementsByClassName('close-button')[0];
      var saveEventButton = document.getElementById('saveEvent');
      var deleteEventButton = document.getElementById('deleteEvent');
      var modalTitle = document.getElementById('modalTitle');
      var eventIdInput = document.getElementById('eventId');
      var eventTitleInput = document.getElementById('eventTitle');
      var eventStartInput = document.getElementById('eventStart');
      var eventEndInput = document.getElementById('eventEnd');
      var allDayCheckbox = document.getElementById('allDay');
      var eventCategoryInput = document.getElementById('eventCategory');
      var eventReminderInput = document.getElementById('eventReminder');
      var searchInput = document.getElementById('eventSearch');
      var currentEventInfo = null;

      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        editable: true,
        selectable: true,
        select: function(info) {
          currentEventInfo = { startStr: info.startStr, endStr: info.endStr, event: null };
          openModal();
        },
        eventClick: function(info) {
          currentEventInfo = { event: info.event };
          openModal();
        },
        eventDrop: function(info) {
          updateEventInDB(info.event);
        },
        eventResize: function(info) {
            updateEventInDB(info.event);
        }
      });

      calendar.render();

      function loadEventsFromDB() {
        if (!db) return;
        const transaction = db.transaction(['events'], 'readonly');
        const objectStore = transaction.objectStore('events');
        const request = objectStore.getAll();

        request.onsuccess = function() {
          const events = request.result.map(e => ({
            ...e,
            start: e.start, // Ensure dates are in correct format
            end: e.end,
            backgroundColor: e.category,
            borderColor: e.category
          }));
          calendar.removeAllEvents();
          calendar.addEventSource(events);
        };
      }
      
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const events = calendar.getEvents();
        events.forEach(event => {
          if (event.title.toLowerCase().includes(searchTerm)) {
            event.setProp('display', 'auto');
          } else {
            event.setProp('display', 'none');
          }
        });
      });

      function openModal() {
        modal.style.display = 'block';
        const event = currentEventInfo ? currentEventInfo.event : null;

        if (event) {
          modalTitle.innerText = 'Edit Event';
          eventIdInput.value = event.extendedProps.id;
          eventTitleInput.value = event.title;
          eventStartInput.value = event.startStr.slice(0, 16);
          eventEndInput.value = event.endStr ? event.endStr.slice(0, 16) : '';
          allDayCheckbox.checked = event.allDay;
          eventCategoryInput.value = event.backgroundColor || '#03a9f4';
          eventReminderInput.value = event.extendedProps.reminder || '';
          deleteEventButton.style.display = 'block';
        } else {
          modalTitle.innerText = 'Add Event';
          eventIdInput.value = '';
          eventTitleInput.value = '';
          eventStartInput.value = currentEventInfo.startStr;
          eventEndInput.value = currentEventInfo.endStr;
          allDayCheckbox.checked = false;
          eventCategoryInput.value = '#03a9f4';
          eventReminderInput.value = '';
          deleteEventButton.style.display = 'none';
        }
      }

      function closeModal() {
        modal.style.display = 'none';
        currentEventInfo = null;
      }

      closeButton.onclick = closeModal;
      window.onclick = function(event) {
        if (event.target == modal) {
          closeModal();
        }
      };

      saveEventButton.onclick = function() {
        const title = eventTitleInput.value;
        const start = eventStartInput.value;
        const end = eventEndInput.value;
        const allDay = allDayCheckbox.checked;
        const category = eventCategoryInput.value;
        const reminder = eventReminderInput.value;

        if (!title || !start) {
          alert('Please enter a title and start time.');
          return;
        }

        const eventData = {
          title: title,
          start: allDay ? start.split('T')[0] : start,
          end: allDay ? null : end,
          allDay: allDay,
          category: category,
          reminder: reminder
        };

        const transaction = db.transaction(['events'], 'readwrite');
        const objectStore = transaction.objectStore('events');

        if (eventIdInput.value) { // Update
          eventData.id = parseInt(eventIdInput.value);
          objectStore.put(eventData);
        } else { // Add new
          objectStore.add(eventData);
        }

        transaction.oncomplete = function() {
          loadEventsFromDB();
          setReminder(eventData);
          closeModal();
        };
      };

      deleteEventButton.onclick = function() {
        if (confirm('Are you sure you want to delete this event?')) {
          const eventId = parseInt(eventIdInput.value);
          const transaction = db.transaction(['events'], 'readwrite');
          const objectStore = transaction.objectStore('events');
          objectStore.delete(eventId);
          transaction.oncomplete = function() {
            loadEventsFromDB();
            closeModal();
          };
        }
      };
      
      function updateEventInDB(event) {
        const eventData = {
          id: event.extendedProps.id,
          title: event.title,
          start: event.startStr,
          end: event.endStr,
          allDay: event.allDay,
          category: event.backgroundColor,
          reminder: event.extendedProps.reminder
        };
        const transaction = db.transaction(['events'], 'readwrite');
        const objectStore = transaction.objectStore('events');
        objectStore.put(eventData);
        transaction.oncomplete = loadEventsFromDB;
      }

      function setReminder(eventData) {
        if (!eventData.reminder) return;
        
        const reminderTime = new Date(eventData.start).getTime() - (eventData.reminder * 60000);
        const now = new Date().getTime();

        if (reminderTime > now) {
          setTimeout(() => {
            showNotification(`Reminder: ${eventData.title}`);
          }, reminderTime - now);
        }
      }

      function showNotification(message) {
        if (Notification.permission === 'granted') {
          new Notification(message);
        } else if (Notification.permission !== 'denied') {
          Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
              new Notification(message);
            }
          });
        }
      }
    });
  </script>
</body>
</html>

